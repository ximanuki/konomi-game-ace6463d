<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#A8D8FF">
    <link rel="stylesheet" href="./css/common.css">
    <link rel="stylesheet" href="./css/components.css">
    <link rel="stylesheet" href="./css/animations.css">
    <title>üé® „Åì„ÅÆ„Åø„Å°„ÇÉ„Çì„ÅÆ„Åä„Åà„Åã„Åç</title>
    <style>
        body {
            background: linear-gradient(135deg, #E8F4FF 0%, #FFE8F5 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: var(--spacing-md);
            padding-top: calc(var(--safe-top) + 70px);
            padding-bottom: calc(var(--safe-bottom) + var(--spacing-md));
            overflow-y: auto;
        }

        .header {
            text-align: center;
            margin-bottom: var(--spacing-md);
            animation: bounceIn 0.6s ease;
        }

        h1 {
            font-size: 24px;
            margin-bottom: var(--spacing-xs);
            color: var(--primary-blue);
        }

        .message {
            font-size: var(--font-md);
            color: var(--text-secondary);
            font-weight: bold;
        }

        /* „ÉÑ„Éº„É´„Éê„Éº */
        .toolbar {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            flex-wrap: wrap;
            justify-content: center;
            animation: slideInDown 0.6s ease;
        }

        .tool-btn {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            border: 3px solid transparent;
            background: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: var(--shadow-sm);
        }

        .tool-btn:active {
            transform: scale(0.9);
        }

        .tool-btn.active {
            border-color: var(--primary-blue);
            transform: scale(1.1);
            box-shadow: 0 0 0 2px rgba(168, 216, 255, 0.3);
        }

        /* Canvas„Ç®„É™„Ç¢ */
        .canvas-container {
            position: relative;
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            padding: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            animation: bounceIn 0.8s ease;
        }

        #drawingCanvas {
            display: block;
            border-radius: var(--radius-md);
            touch-action: none;
            cursor: crosshair;
        }

        /* „Ç´„É©„Éº„Éë„É¨„ÉÉ„Éà */
        .color-palette {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            flex-wrap: wrap;
            justify-content: center;
            animation: slideInUp 0.8s ease;
        }

        .color-btn {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-full);
            border: 3px solid white;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: var(--shadow-md);
        }

        .color-btn:active {
            transform: scale(0.9);
        }

        .color-btn.active {
            border-color: var(--text-primary);
            transform: scale(1.15);
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.2);
        }

        /* „Éö„É≥„Çµ„Ç§„Ç∫ */
        .pen-sizes {
            display: flex;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            justify-content: center;
            animation: slideInUp 0.9s ease;
        }

        .size-btn {
            width: 60px;
            height: 48px;
            border-radius: var(--radius-md);
            border: 3px solid transparent;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: var(--shadow-sm);
            font-size: var(--font-xs);
            font-weight: bold;
        }

        .size-btn:active {
            transform: scale(0.9);
        }

        .size-btn.active {
            border-color: var(--primary-blue);
            background: var(--primary-blue);
            color: white;
        }

        .size-preview {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--spacing-xs);
        }

        .size-preview .dot {
            background: var(--text-primary);
            border-radius: 50%;
        }

        .size-btn.active .size-preview .dot {
            background: white;
        }

        /* „Çπ„Çø„É≥„Éó„Éë„É¨„ÉÉ„Éà */
        .stamp-palette {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            flex-wrap: wrap;
            justify-content: center;
            animation: slideInUp 1s ease;
        }

        .stamp-btn {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            border: 3px solid transparent;
            background: white;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: var(--shadow-sm);
        }

        .stamp-btn:active {
            transform: scale(0.9);
        }

        .stamp-btn.active {
            border-color: var(--primary-yellow);
            transform: scale(1.1);
        }

        /* „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ */
        .action-buttons {
            display: flex;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            justify-content: center;
            animation: bounceIn 1.1s ease;
        }

        .action-btn {
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-md);
            border: none;
            font-size: var(--font-md);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: var(--shadow-md);
            min-height: 48px;
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        .btn-clear {
            background: linear-gradient(135deg, #FFB8B8, #FF9090);
            color: white;
        }

        .btn-save {
            background: linear-gradient(135deg, var(--primary-green), #90E090);
            color: white;
        }

        .btn-gallery {
            background: linear-gradient(135deg, var(--primary-yellow), #FFE880);
            color: var(--text-primary);
        }

        /* „ÇÆ„É£„É©„É™„Éº„É¢„Éº„ÉÄ„É´ */
        .gallery-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: var(--spacing-xl);
        }

        .gallery-overlay.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .gallery-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: 0 16px 32px rgba(0, 0, 0, 0.3);
            animation: bounceIn 0.5s ease;
        }

        .gallery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
        }

        .gallery-header h2 {
            font-size: var(--font-xl);
            color: var(--primary-blue);
        }

        .gallery-close {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            border: none;
            background: var(--primary-pink);
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-md);
        }

        .gallery-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-item-delete {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 32px;
            height: 32px;
            border-radius: var(--radius-full);
            border: none;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            font-size: 18px;
            cursor: pointer;
        }

        .gallery-empty {
            text-align: center;
            padding: var(--spacing-xl);
            color: var(--text-muted);
        }

        @media (max-width: 375px) {
            h1 { font-size: 22px; }
            .message { font-size: var(--font-sm); }
            #drawingCanvas { width: 340px; height: 380px; }
        }

        @media (max-height: 667px) {
            body { padding-top: calc(var(--safe-top) + 60px); }
            h1 { font-size: 20px; }
            #drawingCanvas { width: 340px; height: 360px; }
        }
    </style>
</head>
<body class="no-select">
    <!-- Êàª„Çã„Éú„Çø„É≥ -->
    <a href="./index.html" class="fixed-btn back-btn" id="backBtn" aria-label="„ÇÇ„Å©„Çã">‚Üê</a>
    
    <!-- „Çµ„Ç¶„É≥„Éâ„Éà„Ç∞„É´ -->
    <button class="fixed-btn sound-btn" id="soundBtn" aria-label="„Çµ„Ç¶„É≥„ÉâÂàá„ÇäÊõø„Åà">üîä</button>
    
    <div class="header">
        <h1>üé® „Åì„ÅÆ„Åø„Å°„ÇÉ„Çì„ÅÆ<br>„Åä„Åà„Åã„Åç</h1>
        <p class="message">„Åò„ÇÜ„ÅÜ„Å´„Åã„ÅÑ„Å¶„ÅÇ„Åù„Åº„ÅÜÔºÅ</p>
    </div>
    
    <!-- „ÉÑ„Éº„É´„Éê„Éº -->
    <div class="toolbar">
        <button class="tool-btn active" id="penTool" title="„Éö„É≥">‚úèÔ∏è</button>
        <button class="tool-btn" id="eraserTool" title="„Åë„Åó„Ç¥„É†">üßπ</button>
        <button class="tool-btn" id="stampTool" title="„Çπ„Çø„É≥„Éó">‚ú®</button>
    </div>
    
    <!-- Canvas„Ç®„É™„Ç¢ -->
    <div class="canvas-container">
        <canvas id="drawingCanvas" width="360" height="400"></canvas>
    </div>
    
    <!-- „Ç´„É©„Éº„Éë„É¨„ÉÉ„Éà -->
    <div class="color-palette" id="colorPalette">
        <button class="color-btn active" data-color="#FF9EC8" style="background: #FF9EC8;" title="„Éî„É≥„ÇØ"></button>
        <button class="color-btn" data-color="#FFA07A" style="background: #FFA07A;" title="„Ç™„É¨„É≥„Ç∏"></button>
        <button class="color-btn" data-color="#FFE680" style="background: #FFE680;" title="„Åç„ÅÑ„Çç"></button>
        <button class="color-btn" data-color="#90EE90" style="background: #90EE90;" title="„Åø„Å©„Çä"></button>
        <button class="color-btn" data-color="#87CEEB" style="background: #87CEEB;" title="„ÅÇ„Åä"></button>
        <button class="color-btn" data-color="#DDA0DD" style="background: #DDA0DD;" title="„ÇÄ„Çâ„Åï„Åç"></button>
        <button class="color-btn" data-color="#A0522D" style="background: #A0522D;" title="„Å°„ÇÉ„ÅÑ„Çç"></button>
        <button class="color-btn" data-color="#333333" style="background: #333333;" title="„Åè„Çç"></button>
    </div>
    
    <!-- „Éö„É≥„Çµ„Ç§„Ç∫ -->
    <div class="pen-sizes" id="penSizes">
        <button class="size-btn" data-size="3">
            <div class="size-preview"><div class="dot" style="width: 6px; height: 6px;"></div></div>
            „Åª„Åù„ÅÑ
        </button>
        <button class="size-btn active" data-size="8">
            <div class="size-preview"><div class="dot" style="width: 12px; height: 12px;"></div></div>
            „Åµ„Å§„ÅÜ
        </button>
        <button class="size-btn" data-size="15">
            <div class="size-preview"><div class="dot" style="width: 18px; height: 18px;"></div></div>
            „Åµ„Å®„ÅÑ
        </button>
    </div>
    
    <!-- „Çπ„Çø„É≥„Éó„Éë„É¨„ÉÉ„Éà -->
    <div class="stamp-palette" id="stampPalette" style="display: none;">
        <button class="stamp-btn" data-stamp="‚≠ê">‚≠ê</button>
        <button class="stamp-btn" data-stamp="‚ù§Ô∏è">‚ù§Ô∏è</button>
        <button class="stamp-btn" data-stamp="üòä">üòä</button>
        <button class="stamp-btn" data-stamp="üå∏">üå∏</button>
        <button class="stamp-btn" data-stamp="üê±">üê±</button>
        <button class="stamp-btn" data-stamp="üçé">üçé</button>
    </div>
    
    <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
    <div class="action-buttons">
        <button class="action-btn btn-clear" id="clearBtn">üóëÔ∏è „Åú„Çì„Å∂„Åë„Åô</button>
        <button class="action-btn btn-save" id="saveBtn">üíæ „Åª„Åû„Çì</button>
        <button class="action-btn btn-gallery" id="galleryBtn">üñºÔ∏è „ÇÆ„É£„É©„É™„Éº</button>
    </div>
    
    <!-- „ÇÆ„É£„É©„É™„Éº„É¢„Éº„ÉÄ„É´ -->
    <div class="gallery-overlay" id="galleryOverlay">
        <div class="gallery-content">
            <div class="gallery-header">
                <h2>üé® „ÇÆ„É£„É©„É™„Éº</h2>
                <button class="gallery-close" id="galleryClose">√ó</button>
            </div>
            <div class="gallery-grid" id="galleryGrid">
                <div class="gallery-empty">
                    „Åæ„Å†„Åï„Åè„Å≤„Çì„Åå„Å™„ÅÑ„ÇàÔºÅ<br>
                    „Åà„Çí„Åã„ÅÑ„Å¶„Åª„Åû„Çì„Åó„Å¶„Å≠‚ú®
                </div>
            </div>
        </div>
    </div>
    
    <script src="./js/utils.js"></script>
    <script src="./js/storage.js"></script>
    <script src="./js/sound.js"></script>
    <script src="./js/particle.js"></script>
    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        
        let isDrawing = false;
        let currentTool = 'pen'; // 'pen', 'eraser', 'stamp'
        let currentColor = '#FF9EC8';
        let currentSize = 8;
        let currentStamp = '‚≠ê';
        
        // „Çµ„Ç¶„É≥„ÉâÂàùÊúüÂåñ
        const soundEnabled = GameSettings.getSoundEnabled();
        gameSound.enabled = soundEnabled;
        document.getElementById('soundBtn').textContent = soundEnabled ? 'üîä' : 'üîá';

        // Canvas„ÅÆÂàùÊúüÂåñ
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        
        // LocalStorage„Åã„ÇâÂæ©ÂÖÉ
        loadDrawing();
        
        // ===== „ÉÑ„Éº„É´Âàá„ÇäÊõø„Åà =====
        document.getElementById('penTool').addEventListener('click', () => {
            gameSound.playTap();
            setTool('pen');
        });
        
        document.getElementById('eraserTool').addEventListener('click', () => {
            gameSound.playTap();
            setTool('eraser');
        });
        
        document.getElementById('stampTool').addEventListener('click', () => {
            gameSound.playTap();
            setTool('stamp');
        });
        
        function setTool(tool) {
            currentTool = tool;
            
            // „Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÅÆÊõ¥Êñ∞
            document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
            
            if (tool === 'pen') {
                document.getElementById('penTool').classList.add('active');
                document.getElementById('colorPalette').style.display = 'flex';
                document.getElementById('penSizes').style.display = 'flex';
                document.getElementById('stampPalette').style.display = 'none';
                canvas.style.cursor = 'crosshair';
            } else if (tool === 'eraser') {
                document.getElementById('eraserTool').classList.add('active');
                document.getElementById('colorPalette').style.display = 'none';
                document.getElementById('penSizes').style.display = 'none';
                document.getElementById('stampPalette').style.display = 'none';
                canvas.style.cursor = 'grab';
            } else if (tool === 'stamp') {
                document.getElementById('stampTool').classList.add('active');
                document.getElementById('colorPalette').style.display = 'none';
                document.getElementById('penSizes').style.display = 'none';
                document.getElementById('stampPalette').style.display = 'flex';
                canvas.style.cursor = 'pointer';
            }
        }
        
        // ===== Ëâ≤ÈÅ∏Êäû =====
        document.querySelectorAll('.color-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                gameSound.playTap();
                currentColor = btn.dataset.color;
                
                document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });
        
        // ===== „Éö„É≥„Çµ„Ç§„Ç∫ÈÅ∏Êäû =====
        document.querySelectorAll('.size-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                gameSound.playTap();
                currentSize = parseInt(btn.dataset.size);
                
                document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });
        
        // ===== „Çπ„Çø„É≥„ÉóÈÅ∏Êäû =====
        document.querySelectorAll('.stamp-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                gameSound.playTap();
                currentStamp = btn.dataset.stamp;
                
                document.querySelectorAll('.stamp-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });
        
        // ===== ÊèèÁîªÂá¶ÁêÜ =====
        let lastX = 0;
        let lastY = 0;
        
        function getCanvasPos(e) {
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches ? e.touches[0] : e;
            return {
                x: (touch.clientX - rect.left) * (canvas.width / rect.width),
                y: (touch.clientY - rect.top) * (canvas.height / rect.height)
            };
        }
        
        function startDrawing(e) {
            e.preventDefault();
            const pos = getCanvasPos(e);
            
            if (currentTool === 'stamp') {
                placeStamp(pos.x, pos.y);
            } else {
                isDrawing = true;
                lastX = pos.x;
                lastY = pos.y;
            }
        }
        
        function draw(e) {
            if (!isDrawing) return;
            e.preventDefault();
            
            const pos = getCanvasPos(e);
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(pos.x, pos.y);
            
            if (currentTool === 'pen') {
                ctx.strokeStyle = currentColor;
                ctx.lineWidth = currentSize;
                ctx.globalCompositeOperation = 'source-over';
            } else if (currentTool === 'eraser') {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.lineWidth = 20;
            }
            
            ctx.stroke();
            
            lastX = pos.x;
            lastY = pos.y;
        }
        
        function stopDrawing() {
            if (isDrawing) {
                isDrawing = false;
                autoSave();
            }
        }
        
        function placeStamp(x, y) {
            gameSound.playTap();
            
            ctx.font = '48px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(currentStamp, x, y);
            
            autoSave();
        }
        
        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
        canvas.addEventListener('touchstart', startDrawing);
        canvas.addEventListener('touchmove', draw);
        canvas.addEventListener('touchend', stopDrawing);
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseleave', stopDrawing);
        
        // ===== ÂÖ®Ê∂àÂéª =====
        document.getElementById('clearBtn').addEventListener('click', () => {
            gameSound.playTap();
            
            if (confirm('„Åª„Çì„Å®„ÅÜ„Å´ „Åú„Çì„Å∂ „Åë„Åó„Å¶„ÅÑ„ÅÑÔºü')) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                autoSave();
                gameSound.playCorrect();
            }
        });
        
        // ===== ‰øùÂ≠ò =====
        document.getElementById('saveBtn').addEventListener('click', () => {
            gameSound.playTap();
            saveToGallery();
        });
        
        function saveToGallery() {
            const dataURL = canvas.toDataURL('image/png');
            const gallery = JSON.parse(localStorage.getItem('konomi_drawings') || '[]');
            
            gallery.push({
                image: dataURL,
                date: new Date().toISOString()
            });
            
            // ÊúÄÂ§ß10Êûö„Åæ„Åß‰øùÂ≠ò
            if (gallery.length > 10) {
                gallery.shift();
            }
            
            localStorage.setItem('konomi_drawings', JSON.stringify(gallery));
            gameSound.playWin();
            showToast('üíæ „Åï„Åè„Å≤„Çì„Çí„Åª„Åû„Çì„Åó„Åü„ÇàÔºÅ');
        }
        
        // ===== Ëá™Âãï‰øùÂ≠ò =====
        function autoSave() {
            const dataURL = canvas.toDataURL('image/png');
            localStorage.setItem('konomi_current_drawing', dataURL);
        }
        
        function loadDrawing() {
            const saved = localStorage.getItem('konomi_current_drawing');
            if (saved) {
                const img = new Image();
                img.onload = () => {
                    ctx.drawImage(img, 0, 0);
                };
                img.src = saved;
            }
        }
        
        // ===== „ÇÆ„É£„É©„É™„Éº =====
        document.getElementById('galleryBtn').addEventListener('click', () => {
            gameSound.playTap();
            showGallery();
        });
        
        document.getElementById('galleryClose').addEventListener('click', () => {
            gameSound.playTap();
            document.getElementById('galleryOverlay').classList.remove('show');
        });
        
        document.getElementById('galleryOverlay').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) {
                gameSound.playTap();
                document.getElementById('galleryOverlay').classList.remove('show');
            }
        });
        
        function showGallery() {
            const gallery = JSON.parse(localStorage.getItem('konomi_drawings') || '[]');
            const grid = document.getElementById('galleryGrid');
            
            if (gallery.length === 0) {
                grid.innerHTML = `
                    <div class="gallery-empty">
                        „Åæ„Å†„Åï„Åè„Å≤„Çì„Åå„Å™„ÅÑ„ÇàÔºÅ<br>
                        „Åà„Çí„Åã„ÅÑ„Å¶„Åª„Åû„Çì„Åó„Å¶„Å≠‚ú®
                    </div>
                `;
            } else {
                grid.innerHTML = gallery.map((item, index) => `
                    <div class="gallery-item">
                        <img src="${item.image}" alt="„Åï„Åè„Å≤„Çì ${index + 1}">
                        <button class="gallery-item-delete" onclick="deleteDrawing(${index})">√ó</button>
                    </div>
                `).reverse().join('');
            }
            
            document.getElementById('galleryOverlay').classList.add('show');
        }
        
        window.deleteDrawing = function(index) {
            if (confirm('„Åì„ÅÆ„Åï„Åè„Å≤„Çì„Çí „Åë„Åó„Å¶„ÅÑ„ÅÑÔºü')) {
                const gallery = JSON.parse(localStorage.getItem('konomi_drawings') || '[]');
                gallery.splice(index, 1);
                localStorage.setItem('konomi_drawings', JSON.stringify(gallery));
                gameSound.playTap();
                showGallery();
            }
        };
        
        // ===== „Éà„Éº„Çπ„ÉàÈÄöÁü• =====
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
        
        // ===== „Çµ„Ç¶„É≥„Éâ„Éà„Ç∞„É´ =====
        document.getElementById('soundBtn').addEventListener('click', () => {
            const enabled = gameSound.toggle();
            document.getElementById('soundBtn').textContent = enabled ? 'üîä' : 'üîá';
            GameSettings.setSoundEnabled(enabled);
            if (enabled) {
                gameSound.playTap();
            }
        });
        
        // ===== Êàª„Çã„Éú„Çø„É≥ =====
        document.getElementById('backBtn').addEventListener('click', (e) => {
            gameSound.playTap();
        });
        
        // ÁîªÈù¢Âêë„ÅçÂõ∫ÂÆö
        lockPortrait();
    </script>
</body>
</html>
