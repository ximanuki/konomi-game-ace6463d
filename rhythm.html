<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>ğŸµ ãƒªã‚ºãƒ ã‚²ãƒ¼ãƒ  - ã“ã®ã¿ã¡ã‚ƒã‚“ã®ã‚²ãƒ¼ãƒ </title>
  
  <!-- å…±é€šCSS -->
  <link rel="stylesheet" href="css/common.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/animations.css">
  
  <style>
    body {
      background: linear-gradient(135deg, #E8F4FF 0%, #F4E8FF 100%);
      overflow: hidden;
    }

    /* ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠ */
    .game-container {
      position: relative;
      width: 100%;
      height: 100vh;
      overflow: hidden;
    }

    /* Canvasï¼ˆãƒãƒ¼ãƒ„è½ä¸‹ã‚¨ãƒªã‚¢ï¼‰ */
    #gameCanvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      touch-action: none;
    }

    /* åˆ¤å®šãƒ©ã‚¤ãƒ³ */
    .judge-line {
      position: absolute;
      bottom: 100px;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, transparent, #FF9EC8, transparent);
      box-shadow: 0 0 10px rgba(255, 158, 200, 0.5);
      z-index: 10;
      pointer-events: none;
    }

    /* åˆ¤å®šãƒ†ã‚­ã‚¹ãƒˆ */
    .judge-text {
      position: absolute;
      bottom: 120px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 32px;
      font-weight: bold;
      color: #FF9EC8;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      z-index: 20;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .judge-text.show {
      opacity: 1;
      animation: judgeFlash 0.5s ease;
    }

    .judge-text.perfect {
      color: #FFD700;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
    }

    .judge-text.good {
      color: #B8F0B8;
    }

    .judge-text.miss {
      color: #999999;
    }

    /* æ›²é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« */
    .song-select {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .song-select-modal {
      background: white;
      border-radius: 16px;
      padding: 32px 24px;
      max-width: 340px;
      width: 90%;
      animation: bounceIn 0.5s ease;
    }

    .song-select h2 {
      font-size: 28px;
      color: var(--primary-pink);
      margin-bottom: 24px;
      text-align: center;
    }

    .song-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .song-btn {
      background: linear-gradient(135deg, #FFE8F5 0%, #E8F4FF 100%);
      border: 2px solid var(--primary-pink);
      border-radius: 12px;
      padding: 16px;
      font-size: 18px;
      font-weight: bold;
      color: var(--text-primary);
      text-align: left;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .song-btn:active {
      transform: scale(0.96);
    }

    .song-emoji {
      font-size: 32px;
    }

    .song-info {
      flex: 1;
    }

    .song-name {
      font-size: 18px;
      color: var(--primary-pink);
      margin-bottom: 4px;
    }

    .song-meta {
      font-size: 12px;
      color: var(--text-secondary);
    }

    /* ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ */
    .countdown {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 80px;
      font-weight: bold;
      color: var(--primary-pink);
      text-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      z-index: 100;
      animation: pulse 1s ease;
    }

    /* ãƒªã‚¶ãƒ«ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« */
    .result-modal .stars {
      font-size: 48px;
      margin: 16px 0;
    }

    .result-stats {
      background: #F5F5F5;
      border-radius: 12px;
      padding: 16px;
      margin: 16px 0;
      text-align: left;
    }

    .result-stats div {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
      font-size: 16px;
    }

    .result-stats .label {
      color: var(--text-secondary);
    }

    .result-stats .value {
      font-weight: bold;
      color: var(--text-primary);
    }
  </style>
</head>
<body>
  <div class="game-container">
    <!-- å›ºå®šãƒœã‚¿ãƒ³ -->
    <button class="fixed-btn back-btn" id="backBtn" aria-label="ã‚‚ã©ã‚‹">â†</button>
    <button class="fixed-btn sound-btn" id="soundBtn" aria-label="ã‚µã‚¦ãƒ³ãƒ‰">ğŸ”Š</button>

    <!-- ã‚¹ã‚³ã‚¢è¡¨ç¤º -->
    <div class="score-display" id="scoreDisplay">ğŸµ 0ã¦ã‚“</div>

    <!-- Canvasï¼ˆãƒãƒ¼ãƒ„è½ä¸‹ï¼‰ -->
    <canvas id="gameCanvas"></canvas>

    <!-- åˆ¤å®šãƒ©ã‚¤ãƒ³ -->
    <div class="judge-line"></div>

    <!-- åˆ¤å®šãƒ†ã‚­ã‚¹ãƒˆ -->
    <div class="judge-text" id="judgeText"></div>
  </div>

  <!-- æ›²é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="song-select" id="songSelect">
    <div class="song-select-modal">
      <h2>ğŸµ ãã‚‡ãã‚’ãˆã‚‰ã‚“ã§ã­ï¼</h2>
      <div class="song-list">
        <button class="song-btn" data-song="0">
          <div class="song-emoji">â­</div>
          <div class="song-info">
            <div class="song-name">ãã‚‰ãã‚‰ã¼ã—</div>
            <div class="song-meta">ã‹ã‚“ãŸã‚“ãƒ»30ã³ã‚‡ã†</div>
          </div>
        </button>
        <button class="song-btn" data-song="1">
          <div class="song-emoji">ğŸ¦‹</div>
          <div class="song-info">
            <div class="song-name">ã¡ã‚‡ã†ã¡ã‚‡</div>
            <div class="song-meta">ã‹ã‚“ãŸã‚“ãƒ»30ã³ã‚‡ã†</div>
          </div>
        </button>
        <button class="song-btn" data-song="2">
          <div class="song-emoji">ğŸ¸</div>
          <div class="song-info">
            <div class="song-name">ã‹ãˆã‚‹ã®ã†ãŸ</div>
            <div class="song-meta">ã‹ã‚“ãŸã‚“ãƒ»30ã³ã‚‡ã†</div>
          </div>
        </button>
      </div>
    </div>
  </div>

  <!-- å…±é€šJS -->
  <script src="js/sound.js"></script>
  <script src="js/utils.js"></script>

  <!-- ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ -->
  <script>
    // ========== è¨­å®š ==========
    const CONFIG = {
      JUDGE_LINE_Y: 567, // åˆ¤å®šãƒ©ã‚¤ãƒ³Yåº§æ¨™ï¼ˆä¸‹ã‹ã‚‰100pxï¼‰
      PERFECT_TIMING: 50, // Perfectåˆ¤å®šç¯„å›²ï¼ˆÂ±50msï¼‰
      GOOD_TIMING: 150, // Goodåˆ¤å®šç¯„å›²ï¼ˆÂ±150msï¼‰
      NOTE_SIZE: 48, // ãƒãƒ¼ãƒ„ã‚µã‚¤ã‚º
      NOTE_FALL_DURATION: 3000, // ãƒãƒ¼ãƒ„ãŒè½ã¡ã‚‹æ™‚é–“ï¼ˆ3ç§’ï¼‰
      SPAWN_OFFSET: -100, // ãƒãƒ¼ãƒ„ç”Ÿæˆä½ç½®ï¼ˆç”»é¢ä¸Šï¼‰
    };

    // ========== æ›²ãƒ‡ãƒ¼ã‚¿ ==========
    const SONGS = [
      {
        name: 'ãã‚‰ãã‚‰ã¼ã—',
        emoji: 'â­',
        bpm: 60,
        notes: [
          // ãƒ‰ ãƒ‰ ã‚½ ã‚½ ãƒ© ãƒ© ã‚½ãƒ¼
          { time: 0, type: 'â­', pitch: 261.63 },
          { time: 1000, type: 'â­', pitch: 261.63 },
          { time: 2000, type: 'â¤ï¸', pitch: 392.00 },
          { time: 3000, type: 'â¤ï¸', pitch: 392.00 },
          { time: 4000, type: 'ğŸŒ¸', pitch: 440.00 },
          { time: 5000, type: 'ğŸŒ¸', pitch: 440.00 },
          { time: 6000, type: 'â¤ï¸', pitch: 392.00 },
          // ãƒ•ã‚¡ ãƒ•ã‚¡ ãƒŸ ãƒŸ ãƒ¬ ãƒ¬ ãƒ‰ãƒ¼
          { time: 8000, type: 'â­', pitch: 349.23 },
          { time: 9000, type: 'â­', pitch: 349.23 },
          { time: 10000, type: 'â¤ï¸', pitch: 329.63 },
          { time: 11000, type: 'â¤ï¸', pitch: 329.63 },
          { time: 12000, type: 'ğŸŒ¸', pitch: 293.66 },
          { time: 13000, type: 'ğŸŒ¸', pitch: 293.66 },
          { time: 14000, type: 'â­', pitch: 261.63 },
        ]
      },
      {
        name: 'ã¡ã‚‡ã†ã¡ã‚‡',
        emoji: 'ğŸ¦‹',
        bpm: 90,
        notes: [
          // ã‚½ ãƒŸ ãƒŸ ãƒ•ã‚¡ ãƒ¬ ãƒ¬
          { time: 0, type: 'ğŸŒ¸', pitch: 392.00 },
          { time: 666, type: 'â¤ï¸', pitch: 329.63 },
          { time: 1333, type: 'â¤ï¸', pitch: 329.63 },
          { time: 2000, type: 'â­', pitch: 349.23 },
          { time: 2666, type: 'â­', pitch: 293.66 },
          { time: 3333, type: 'â­', pitch: 293.66 },
          // ãƒ‰ ãƒ¬ ãƒŸ ãƒ•ã‚¡ ã‚½ã‚½ã‚½
          { time: 4000, type: 'â­', pitch: 261.63 },
          { time: 4666, type: 'â¤ï¸', pitch: 293.66 },
          { time: 5333, type: 'â¤ï¸', pitch: 329.63 },
          { time: 6000, type: 'ğŸŒ¸', pitch: 349.23 },
          { time: 6666, type: 'ğŸŒ¸', pitch: 392.00 },
          { time: 7333, type: 'ğŸŒ¸', pitch: 392.00 },
          { time: 8000, type: 'ğŸŒ¸', pitch: 392.00 },
        ]
      },
      {
        name: 'ã‹ãˆã‚‹ã®ã†ãŸ',
        emoji: 'ğŸ¸',
        bpm: 120,
        notes: [
          // ãƒ‰ ãƒ¬ ãƒŸ ãƒ•ã‚¡ ãƒŸãƒ¼ ãƒ¬ãƒ¼ ãƒ‰
          { time: 0, type: 'â­', pitch: 261.63 },
          { time: 500, type: 'â­', pitch: 293.66 },
          { time: 1000, type: 'â¤ï¸', pitch: 329.63 },
          { time: 1500, type: 'â¤ï¸', pitch: 349.23 },
          { time: 2000, type: 'â¤ï¸', pitch: 329.63 },
          { time: 3000, type: 'â­', pitch: 293.66 },
          { time: 4000, type: 'â­', pitch: 261.63 },
          // ãƒŸ ãƒ•ã‚¡ ã‚½ ãƒ© ã‚½ãƒ¼ ãƒ•ã‚¡ãƒ¼ ãƒŸ
          { time: 5000, type: 'â¤ï¸', pitch: 329.63 },
          { time: 5500, type: 'â¤ï¸', pitch: 349.23 },
          { time: 6000, type: 'ğŸŒ¸', pitch: 392.00 },
          { time: 6500, type: 'ğŸŒ¸', pitch: 440.00 },
          { time: 7000, type: 'ğŸŒ¸', pitch: 392.00 },
          { time: 8000, type: 'â¤ï¸', pitch: 349.23 },
          { time: 9000, type: 'â¤ï¸', pitch: 329.63 },
        ]
      }
    ];

    // ========== ã‚²ãƒ¼ãƒ çŠ¶æ…‹ ==========
    class RhythmGame {
      constructor() {
        this.canvas = document.getElementById('gameCanvas');
        this.ctx = this.canvas.getContext('2d');
        this.resizeCanvas();
        
        this.currentSong = null;
        this.notes = [];
        this.activeNotes = [];
        this.score = 0;
        this.combo = 0;
        this.stats = { perfect: 0, good: 0, miss: 0 };
        this.startTime = 0;
        this.isPlaying = false;
        this.audioContext = null;
        this.scheduledNotes = new Set();
        
        this.setupEvents();
      }

      resizeCanvas() {
        this.canvas.width = window.innerWidth;
        this.canvas.height = window.innerHeight;
      }

      setupEvents() {
        // ç”»é¢ã‚¿ãƒƒãƒ—ã§åˆ¤å®š
        this.canvas.addEventListener('touchstart', (e) => this.handleTap(e));
        this.canvas.addEventListener('click', (e) => this.handleTap(e));
        
        // ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ
        window.addEventListener('resize', () => this.resizeCanvas());
      }

      startSong(songIndex) {
        this.currentSong = SONGS[songIndex];
        this.notes = [...this.currentSong.notes];
        this.activeNotes = [];
        this.score = 0;
        this.combo = 0;
        this.stats = { perfect: 0, good: 0, miss: 0 };
        this.scheduledNotes = new Set();
        
        // AudioContextåˆæœŸåŒ–
        gameSound.init();
        this.audioContext = gameSound.audioContext;
        
        // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
        this.showCountdown(() => {
          this.isPlaying = true;
          this.startTime = performance.now();
          this.gameLoop();
        });
      }

      showCountdown(callback) {
        const counts = ['3', '2', '1', 'GO!'];
        let index = 0;

        const showNext = () => {
          if (index >= counts.length) {
            callback();
            return;
          }

          const countdown = document.createElement('div');
          countdown.className = 'countdown';
          countdown.textContent = counts[index];
          document.body.appendChild(countdown);

          gameSound.playTap();

          setTimeout(() => {
            countdown.remove();
            index++;
            showNext();
          }, 1000);
        };

        showNext();
      }

      gameLoop() {
        if (!this.isPlaying) return;

        const currentTime = performance.now() - this.startTime;
        
        // ãƒãƒ¼ãƒ„ç”Ÿæˆ
        this.spawnNotes(currentTime);
        
        // ãƒãƒ¼ãƒ„æ›´æ–°
        this.updateNotes(currentTime);
        
        // æç”»
        this.render();
        
        // ã‚²ãƒ¼ãƒ çµ‚äº†ãƒã‚§ãƒƒã‚¯
        if (this.checkGameEnd(currentTime)) {
          this.endGame();
          return;
        }
        
        requestAnimationFrame(() => this.gameLoop());
      }

      spawnNotes(currentTime) {
        this.notes.forEach((note, index) => {
          const spawnTime = note.time - CONFIG.NOTE_FALL_DURATION;
          
          if (currentTime >= spawnTime && !this.scheduledNotes.has(index)) {
            this.activeNotes.push({
              ...note,
              id: index,
              x: this.canvas.width / 2,
              y: CONFIG.SPAWN_OFFSET,
              spawnTime: currentTime,
              judged: false
            });
            this.scheduledNotes.add(index);
            
            // éŸ³ç¬¦ã®éŸ³ã‚’å†ç”Ÿ
            this.playNoteSound(note.pitch, note.time);
          }
        });
      }

      playNoteSound(pitch, scheduledTime) {
        if (!this.audioContext) return;
        
        const osc = this.audioContext.createOscillator();
        const gain = this.audioContext.createGain();
        
        osc.connect(gain);
        gain.connect(gameSound.gainNode);
        
        osc.frequency.value = pitch;
        osc.type = 'sine';
        
        const startTime = this.audioContext.currentTime + (scheduledTime / 1000);
        gain.gain.setValueAtTime(0.15, startTime);
        gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.5);
        
        osc.start(startTime);
        osc.stop(startTime + 0.5);
      }

      updateNotes(currentTime) {
        this.activeNotes = this.activeNotes.filter(note => {
          if (note.judged) return false;
          
          // ãƒãƒ¼ãƒ„ã®ä½ç½®è¨ˆç®—
          const elapsed = currentTime - note.spawnTime;
          const progress = elapsed / CONFIG.NOTE_FALL_DURATION;
          note.y = CONFIG.SPAWN_OFFSET + (CONFIG.JUDGE_LINE_Y - CONFIG.SPAWN_OFFSET + 100) * progress;
          
          // ç”»é¢å¤–ã«å‡ºãŸã‚‰ãƒŸã‚¹
          if (note.y > CONFIG.JUDGE_LINE_Y + 100) {
            this.judgeNote(note, 'miss');
            return false;
          }
          
          return true;
        });
      }

      handleTap(e) {
        if (!this.isPlaying) return;
        e.preventDefault();
        
        const currentTime = performance.now() - this.startTime;
        
        // ä¸€ç•ªè¿‘ã„ãƒãƒ¼ãƒ„ã‚’åˆ¤å®š
        let closestNote = null;
        let minDistance = Infinity;
        
        this.activeNotes.forEach(note => {
          if (note.judged) return;
          
          const distance = Math.abs(note.y - CONFIG.JUDGE_LINE_Y);
          if (distance < minDistance) {
            minDistance = distance;
            closestNote = note;
          }
        });
        
        if (closestNote && minDistance < 100) {
          const timeDiff = Math.abs((closestNote.time) - currentTime);
          
          if (timeDiff <= CONFIG.PERFECT_TIMING) {
            this.judgeNote(closestNote, 'perfect');
          } else if (timeDiff <= CONFIG.GOOD_TIMING) {
            this.judgeNote(closestNote, 'good');
          } else {
            this.judgeNote(closestNote, 'miss');
          }
        }
      }

      judgeNote(note, result) {
        note.judged = true;
        this.stats[result]++;
        
        let points = 0;
        let text = '';
        
        if (result === 'perfect') {
          points = 10;
          text = 'ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼';
          this.combo++;
          gameSound.playJudge('perfect');
          this.createParticles(note.x, CONFIG.JUDGE_LINE_Y, 'â­');
        } else if (result === 'good') {
          points = 5;
          text = 'ã‚°ãƒƒãƒ‰ï¼';
          this.combo++;
          gameSound.playJudge('good');
        } else {
          points = 0;
          text = '';
          this.combo = 0;
          gameSound.playJudge('miss');
        }
        
        this.score += points;
        this.updateUI(text, result);
      }

      createParticles(x, y, emoji) {
        const count = 5;
        for (let i = 0; i < count; i++) {
          const particle = document.createElement('div');
          particle.textContent = emoji;
          particle.style.position = 'fixed';
          particle.style.left = x + 'px';
          particle.style.top = y + 'px';
          particle.style.fontSize = '24px';
          particle.style.pointerEvents = 'none';
          particle.style.zIndex = '50';
          particle.style.animation = 'starFall 1s ease-out forwards';
          particle.style.animationDelay = (i * 0.1) + 's';
          document.body.appendChild(particle);
          
          setTimeout(() => particle.remove(), 1100);
        }
      }

      updateUI(text, result) {
        document.getElementById('scoreDisplay').textContent = `ğŸµ ${this.score}ã¦ã‚“`;
        
        const judgeText = document.getElementById('judgeText');
        judgeText.textContent = text;
        judgeText.className = `judge-text ${result}`;
        if (text) {
          judgeText.classList.add('show');
          setTimeout(() => judgeText.classList.remove('show'), 500);
        }
      }

      render() {
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        
        // ãƒãƒ¼ãƒ„æç”»
        this.activeNotes.forEach(note => {
          if (note.judged) return;
          
          this.ctx.font = `${CONFIG.NOTE_SIZE}px Arial`;
          this.ctx.textAlign = 'center';
          this.ctx.textBaseline = 'middle';
          this.ctx.fillText(note.type, note.x, note.y);
        });
      }

      checkGameEnd(currentTime) {
        const lastNote = this.notes[this.notes.length - 1];
        return currentTime > lastNote.time + 2000 && this.activeNotes.length === 0;
      }

      endGame() {
        this.isPlaying = false;
        
        // çµæœè¡¨ç¤º
        setTimeout(() => {
          this.showResult();
        }, 500);
      }

      showResult() {
        const total = this.stats.perfect + this.stats.good + this.stats.miss;
        const accuracy = total > 0 ? ((this.stats.perfect + this.stats.good) / total * 100).toFixed(0) : 0;
        
        const overlay = document.createElement('div');
        overlay.className = 'modal-overlay';
        
        const modal = document.createElement('div');
        modal.className = 'modal result-modal';
        modal.innerHTML = `
          <h2>ğŸ‰ ã‚¯ãƒªã‚¢ï¼</h2>
          <div class="stars">${this.getStars()}</div>
          <div class="result-stats">
            <div>
              <span class="label">ã‚¹ã‚³ã‚¢:</span>
              <span class="value">${this.score}ã¦ã‚“</span>
            </div>
            <div>
              <span class="label">ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆ:</span>
              <span class="value">${this.stats.perfect}ã‹ã„</span>
            </div>
            <div>
              <span class="label">ã‚°ãƒƒãƒ‰:</span>
              <span class="value">${this.stats.good}ã‹ã„</span>
            </div>
            <div>
              <span class="label">ãƒŸã‚¹:</span>
              <span class="value">${this.stats.miss}ã‹ã„</span>
            </div>
            <div>
              <span class="label">ã›ã„ã‹ãã•:</span>
              <span class="value">${accuracy}%</span>
            </div>
          </div>
          <div class="modal-buttons">
            <button class="btn btn-primary" id="retryBtn">ã‚‚ã†ã„ã¡ã©</button>
            <button class="btn btn-secondary" id="backToMenuBtn">ãã‚‡ããˆã‚‰ã³</button>
          </div>
        `;
        
        overlay.appendChild(modal);
        document.body.appendChild(overlay);
        
        gameSound.playClear();
        
        // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
        modal.querySelector('#retryBtn').addEventListener('click', () => {
          gameSound.playTap();
          overlay.remove();
          this.startSong(SONGS.indexOf(this.currentSong));
        });
        
        modal.querySelector('#backToMenuBtn').addEventListener('click', () => {
          gameSound.playTap();
          overlay.remove();
          document.getElementById('songSelect').style.display = 'flex';
        });
      }

      getStars() {
        const accuracy = (this.stats.perfect + this.stats.good) / this.notes.length;
        if (accuracy >= 0.9) return 'â­â­â­';
        if (accuracy >= 0.7) return 'â­â­';
        return 'â­';
      }
    }

    // ========== åˆæœŸåŒ– ==========
    const game = new RhythmGame();

    // æ›²é¸æŠ
    document.querySelectorAll('.song-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        gameSound.playTap();
        const songIndex = parseInt(btn.dataset.song);
        document.getElementById('songSelect').style.display = 'none';
        game.startSong(songIndex);
      });
    });

    // æˆ»ã‚‹ãƒœã‚¿ãƒ³
    document.getElementById('backBtn').addEventListener('click', () => {
      gameSound.playTap();
      if (game.isPlaying) {
        showConfirm('ã‚²ãƒ¼ãƒ ã‚’ã‚„ã‚ã¾ã™ã‹ï¼Ÿ', () => {
          game.isPlaying = false;
          window.location.href = 'index.html';
        });
      } else {
        window.location.href = 'index.html';
      }
    });

    // ã‚µã‚¦ãƒ³ãƒ‰ãƒœã‚¿ãƒ³
    document.getElementById('soundBtn').addEventListener('click', () => {
      const enabled = gameSound.toggle();
      document.getElementById('soundBtn').textContent = enabled ? 'ğŸ”Š' : 'ğŸ”‡';
    });

    // ç¸¦å‘ãå›ºå®š
    lockPortrait();
  </script>
</body>
</html>
